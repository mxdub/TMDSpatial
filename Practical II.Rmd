---
title: "Practical II"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## The simulation framework

### Install

Borrow from Thompson et al. (2020) and slightly modified.

To install from GitHub

```{r, eval=F}
devtools::install_github("mxdub/TMDSpatial")
```

### Use

Function is quickly described on GitHub - see Thompson et al. (2020) for details on implementation. The overall idea :

![](ThompsonFramework.JPG)

We are going to use only the simulation function : *simulate_MC()*. All parameters can be view in the help (?simulate_MC()). Main parameters are already set for our use here.

For occupancy models, we will use only two species.

The typical use of that function :

```{r, message=F, output = F, results='hide', warning=FALSE}
library(TMDSpatial)
# Some additional packages might be needed:
library(tidyverse)
library(vegan)

n_patch = 100
n_species = 2

sim = simulate_MC(patches = n_patch,     # Number of patch
                  species = n_species,   # Number of species
                  kernel_exp = 0.001,    # Rate of decrease of disp. kernel (e.g. P(disp) = exp(-kernel_exp*dist(i,j)))
                  env_optima = c(0.3, 0.6),
                  env_niche_breadth = 0.1,
                  int_mat = matrix( c(0.05,0.03,
                                      0.03,0.05) , nrow = 2, ncol = 2))
```

At the end of simulation. Two plots are displayed - (i) species 'environmental niche', (ii) interaction matrix.

In this case; environmental niche breadth are small (env_niche_breadth = .1), dispersal is not limited by distance (kernel = -0.001), and species are interacting.

The dispersal kernel :

```{r}
curve(exp(-0.001*x), xlim = c(0,140), ylim = c(0,1)) # Max distance among patch is ca. 140 units
```

You can also plot patches in space, with their environmental value to see how environmental values are clustered in space.

```{r}

plots_envt(sim)

```

In the end, you also have some helper functions to gather some data from the simulation output :

To get environmental values and geographical positions :

```{r}

data_envt = get_envt(sim)
data_geo = get_geoposition(sim)

```

And to get abundances and/or occupancies (i.e. presence/absence)

```{r}

abundances = sim_to_matrix(sim)
occupancies = abund_to_occ(abundances)

```

And lastly, it's possible to plot directly occupancies over time for all species:

```{r}

plots_occupancies(occupancies)

```
